<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>Territorial Online</title>

<style>
body{margin:0;background:#000;color:white;font-family:tahoma}
canvas{display:block}

#consoleBox{
  position:fixed;
  top:10px;
  left:10px;
  width:320px;
  height:200px;
  background:black;
  color:lime;
  display:none;
  padding:10px;
  z-index:9999;
  border:1px solid lime;
}

#consoleBox span{
  cursor:pointer;
  float:right;
  color:red;
  font-weight:bold
}
</style>
</head>

<body>

<div id="consoleBox">
  <span>X</span>
  <pre id="consoleText"></pre>
</div>

<div id="lobby">
  <input id="nicknameInput" placeholder="اسمك">
  <button id="createRoomBtn">إنشاء غرفة</button>
  <button id="joinRoomBtn">انضم</button>
  <input id="roomIdInput" placeholder="رمز الغرفة">
  <button id="startGameBtn">ابدأ</button>
  <div id="playersList"></div>
</div>

<canvas id="game" width="600" height="450"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script src="socket-client.js"></script>

<script>
const game = document.getElementById("game");
const ctx = game.getContext("2d");

let grid = [];

const consoleBox = document.getElementById("consoleBox");
const consoleText = document.getElementById("consoleText");

function log(m){
  consoleText.textContent += m + "\n";
}

document.addEventListener("keydown",e=>{
  if(e.key.toLowerCase()==="c"){
    consoleBox.style.display =
      consoleBox.style.display==="none"?"block":"none";
  }
});
consoleBox.querySelector("span").onclick=()=>{
  consoleBox.style.display="none";
};

window.addEventListener("multiplayer_start", e=>{
  const players = e.detail.players;
  log("تم بدء اللعبة");

  grid = [];
  players.forEach((p,i)=>{
    grid.push({
      owner:i,
      troops:20,
      x: i%2===0? 0:550,
      y: i<2?0:400
    });
  });

  draw();
});

window.addEventListener("multiplayer_action",e=>{
  const a = e.detail;
  grid[a.to].owner = a.owner;
  draw();
});

function draw(){
  ctx.clearRect(0,0,600,450);
  grid.forEach(c=>{
    ctx.fillStyle = ["red","blue","yellow","green"][c.owner];
    ctx.fillRect(c.x,c.y,50,50);
  });
}

game.onclick=()=>{
  multiplayer.send({ owner:0, to:1 });
};
</script>

</body>
</html>
